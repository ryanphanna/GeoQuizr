<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geography Quiz Game - Firebase Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 600px;
            width: 90%;
            overflow: hidden;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .header {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            padding: 30px;
            text-align: center;
            color: white;
            position: relative;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .status-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            background: rgba(255,255,255,0.2);
        }

        .status-indicator.online {
            background: rgba(76, 175, 80, 0.3);
        }

        .status-indicator.offline {
            background: rgba(244, 67, 54, 0.3);
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            display: none;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .game-content {
            padding: 30px;
        }

        .loading-screen {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e6ed;
        }

        .tab-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 1em;
            position: relative;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            color: #667eea;
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .leaderboard {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .leaderboard h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #e0e6ed;
        }

        .leaderboard-entry:last-child {
            border-bottom: none;
        }

        .leaderboard-rank {
            font-weight: bold;
            color: #667eea;
            margin-right: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102,126,234,0.3);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-size: 0.9em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 1em;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .question-editor {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .user-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .hidden {
            display: none !important;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            animation: slideIn 0.3s ease;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            animation: slideIn 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="back-btn" onclick="goBack()">‚Üê Back</button>
            <div class="status-indicator offline" id="status">Offline</div>
            <h1>üó∫Ô∏è Geography Quiz</h1>
            <p id="header-subtitle">Connecting to Firebase...</p>
        </div>
        
        <div class="game-content">
            <!-- Loading Screen -->
            <div id="loading-screen" class="loading-screen">
                <div class="loading-spinner"></div>
                <p>Setting up your game...</p>
                <small style="color: #666; margin-top: 10px; display: block;">This may take a few seconds on first load</small>
            </div>

            <!-- Login Screen -->
            <div id="login-screen" class="hidden">
                <div style="text-align: center;">
                    <h2 style="margin-bottom: 20px; color: #667eea;">Welcome! Let's get started</h2>
                    <p style="color: #666; margin-bottom: 30px;">Choose a username to track your progress and compete with others!</p>
                </div>
                
                <div class="form-group">
                    <label>Choose Your Username:</label>
                    <input type="text" id="username-input" placeholder="Enter a cool username..." maxlength="20">
                    <small style="color: #666;">This will be shown on the leaderboard</small>
                </div>
                
                <button class="btn btn-primary" style="width: 100%;" onclick="createUser()">
                    Start Playing! üéÆ
                </button>
            </div>

            <!-- Main Game Interface -->
            <div id="main-interface" class="hidden">
                <!-- User Info -->
                <div class="user-info" id="user-info">
                    <div>Welcome, <strong id="username-display">Player</strong>!</div>
                    <small>Total Score: <span id="total-score">0</span> points</small>
                </div>

                <!-- Tab Navigation -->
                <div class="tab-navigation" id="tab-navigation">
                    <button class="tab-btn active" onclick="switchTab('play')">üéÆ Play</button>
                    <button class="tab-btn" onclick="switchTab('leaderboard')">üèÜ Leaderboard</button>
                    <button class="tab-btn" onclick="switchTab('add')">‚ûï Add Questions</button>
                    <button class="tab-btn" onclick="switchTab('profile')">üë§ Profile</button>
                </div>

                <!-- Play Tab -->
                <div class="tab-content active" id="play-tab">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="background: #f8f9ff; padding: 15px; border-radius: 10px;">
                            <h3 style="color: #667eea; margin-bottom: 10px;">üéØ Ready to Quiz?</h3>
                            <p style="color: #666; font-size: 0.9em;">Questions from the community: <span id="total-questions">0</span></p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Select City:</label>
                        <select id="city-select">
                            <option value="all">All Cities</option>
                            <option value="Toronto">Toronto</option>
                            <option value="Vancouver">Vancouver</option>
                            <option value="Montreal">Montreal</option>
                            <option value="Chicago">Chicago</option>
                            <option value="Seattle">Seattle</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Select Game Mode:</label>
                        <select id="mode-select">
                            <option value="all">All Modes</option>
                            <option value="transit">üöá Transit Challenge</option>
                            <option value="nextstation">üöâ Next Station</option>
                            <option value="landmark">üèõÔ∏è Landmarks</option>
                            <option value="neighborhood">üèòÔ∏è Neighborhoods</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Number of Questions:</label>
                        <select id="question-count">
                            <option value="5">5 Questions (Quick)</option>
                            <option value="10" selected>10 Questions (Standard)</option>
                            <option value="20">20 Questions (Marathon)</option>
                        </select>
                    </div>

                    <button class="btn btn-primary" style="width: 100%;" onclick="startQuiz()">
                        Start Quiz! üöÄ
                    </button>
                </div>

                <!-- Leaderboard Tab -->
                <div class="tab-content" id="leaderboard-tab">
                    <div class="leaderboard">
                        <h3>üèÜ Top Players</h3>
                        <div id="leaderboard-list">
                            <p style="text-align: center; color: #666;">Loading leaderboard...</p>
                        </div>
                    </div>
                    
                    <button class="btn" style="background: #28a745; color: white; width: 100%;" onclick="loadLeaderboard()">
                        Refresh Leaderboard
                    </button>
                </div>

                <!-- Add Questions Tab -->
                <div class="tab-content" id="add-tab">
                    <div class="question-editor">
                        <h3 style="color: #667eea; margin-bottom: 15px;">Add a New Question</h3>
                        
                        <div class="form-group">
                            <label>City:</label>
                            <select id="new-city">
                                <option value="Toronto">Toronto</option>
                                <option value="Vancouver">Vancouver</option>
                                <option value="Montreal">Montreal</option>
                                <option value="Chicago">Chicago</option>
                                <option value="Seattle">Seattle</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Game Mode:</label>
                            <select id="new-mode">
                                <option value="transit">Transit Challenge</option>
                                <option value="nextstation">Next Station</option>
                                <option value="landmark">Landmarks</option>
                                <option value="neighborhood">Neighborhoods</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Question:</label>
                            <textarea id="new-question" rows="2" placeholder="e.g., What station comes after Union Station heading north?"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Correct Answer:</label>
                            <input type="text" id="new-correct" placeholder="e.g., King Station">
                        </div>

                        <div class="form-group">
                            <label>Wrong Options (comma separated):</label>
                            <input type="text" id="new-wrong" placeholder="e.g., Queen Station, Dundas Station, College Station">
                        </div>

                        <button class="btn btn-primary" onclick="addQuestion()">Submit Question</button>
                    </div>

                    <div id="add-feedback"></div>
                </div>

                <!-- Profile Tab -->
                <div class="tab-content" id="profile-tab">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="profile-score">0</div>
                            <div class="stat-label">Total Score</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="stat-value" id="profile-games">0</div>
                            <div class="stat-label">Games Played</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <div class="stat-value" id="profile-questions">0</div>
                            <div class="stat-label">Questions Added</div>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <button class="btn" style="background: #dc3545; color: white;" onclick="logout()">
                            Sign Out
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quiz Container -->
            <div id="quiz-container" class="hidden">
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <span style="font-size: 1.2em; color: #667eea;">Q<span id="current-q">1</span>/<span id="total-q">10</span></span>
                    <span style="font-size: 1.2em; color: #4CAF50;">Score: <span id="quiz-score">0</span></span>
                </div>

                <div style="background: #f8f9ff; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <h3 id="question-text" style="margin-bottom: 20px;"></h3>
                    <div id="options" style="display: grid; gap: 10px;"></div>
                </div>

                <div id="feedback" class="hidden" style="padding: 15px; border-radius: 10px; margin-bottom: 20px;"></div>

                <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()" disabled>Next Question</button>
            </div>
        </div>
    </div>

    <!-- STEP 1: Add Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // ============================================
        // YOUR FIREBASE CONFIG - Already configured!
        // ============================================
        const firebaseConfig = {
            apiKey: "AIza5yCka6MweRe1EThGRTkZjwj-mWswvJGNU",
            authDomain: "geoquizr.firebaseapp.com",
            projectId: "geoquizr",
            storageBucket: "geoquizr.firebasestorage.app",
            messagingSenderId: "628669854362",
            appId: "1:628669854362:web:72e9fc1f98ec55598ac023"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ============================================
        // GAME CODE STARTS HERE
        // ============================================
        
        // Global variables
        let currentUser = null;
        let currentQuiz = null;
        let allQuestions = [];

        // Check if Firebase is connected
        function checkConnection() {
            db.collection('_heartbeat').doc('test').set({
                timestamp: new Date()
            }).then(() => {
                console.log('Firebase connected!');
                document.getElementById('status').textContent = 'üü¢ Online';
                document.getElementById('status').classList.remove('offline');
                document.getElementById('status').classList.add('online');
                document.getElementById('header-subtitle').textContent = 'Connected to Firebase!';
                initializeApp();
            }).catch(error => {
                console.error('Firebase connection error:', error);
                document.getElementById('status').textContent = 'üî¥ Offline';
                document.getElementById('header-subtitle').textContent = 'Connection error - Check console';
                document.getElementById('loading-screen').innerHTML = `
                    <div style="color: #dc3545;">
                        <h3>Connection Error</h3>
                        <p>Could not connect to Firebase.</p>
                        <p style="font-size: 0.9em; margin-top: 10px;">Did you add your Firebase config?</p>
                        <button class="btn btn-primary" onclick="location.reload()">Try Again</button>
                    </div>
                `;
            });
        }

        // Initialize app
        function initializeApp() {
            // Check for existing user
            const savedUsername = localStorage.getItem('geoQuizUsername');
            if (savedUsername) {
                loadUser(savedUsername);
            } else {
                document.getElementById('loading-screen').classList.add('hidden');
                document.getElementById('login-screen').classList.remove('hidden');
            }
        }

        // Create new user
        function createUser() {
            const username = document.getElementById('username-input').value.trim();
            
            if (!username) {
                alert('Please enter a username!');
                return;
            }

            if (username.length < 3) {
                alert('Username must be at least 3 characters!');
                return;
            }

            // Check if username exists
            db.collection('users').doc(username).get().then(doc => {
                if (doc.exists) {
                    if (confirm(`Welcome back ${username}! Load your existing profile?`)) {
                        loadUser(username);
                    }
                } else {
                    // Create new user
                    db.collection('users').doc(username).set({
                        username: username,
                        totalScore: 0,
                        gamesPlayed: 0,
                        questionsAdded: 0,
                        joinedAt: new Date(),
                        lastPlayed: new Date()
                    }).then(() => {
                        localStorage.setItem('geoQuizUsername', username);
                        loadUser(username);
                    }).catch(error => {
                        console.error('Error creating user:', error);
                        alert('Error creating user. Please try again.');
                    });
                }
            });
        }

        // Load user data
        function loadUser(username) {
            db.collection('users').doc(username).get().then(doc => {
                if (doc.exists) {
                    currentUser = doc.data();
                    currentUser.username = username;
                    
                    // Update UI
                    document.getElementById('username-display').textContent = username;
                    document.getElementById('total-score').textContent = currentUser.totalScore || 0;
                    
                    // Show main interface
                    document.getElementById('loading-screen').classList.add('hidden');
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('main-interface').classList.remove('hidden');
                    document.getElementById('header-subtitle').textContent = 'Test your knowledge!';
                    
                    // Load questions and leaderboard
                    loadQuestions();
                    loadLeaderboard();
                    updateProfile();
                }
            });
        }

        // Load questions from Firestore
        function loadQuestions() {
            db.collection('questions').get().then(snapshot => {
                allQuestions = [];
                snapshot.forEach(doc => {
                    allQuestions.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                document.getElementById('total-questions').textContent = allQuestions.length;
                console.log(`Loaded ${allQuestions.length} questions`);
            }).catch(error => {
                console.error('Error loading questions:', error);
            });
        }

        // Start quiz
        function startQuiz() {
            const city = document.getElementById('city-select').value;
            const mode = document.getElementById('mode-select').value;
            const count = parseInt(document.getElementById('question-count').value);
            
            // Filter questions
            let filtered = allQuestions;
            
            if (city !== 'all') {
                filtered = filtered.filter(q => q.city === city);
            }
            
            if (mode !== 'all') {
                filtered = filtered.filter(q => q.mode === mode);
            }
            
            if (filtered.length === 0) {
                alert('No questions available for this selection. Try different options or add some questions!');
                return;
            }
            
            // Shuffle and select questions
            const shuffled = filtered.sort(() => Math.random() - 0.5);
            const selected = shuffled.slice(0, Math.min(count, shuffled.length));
            
            // Initialize quiz
            currentQuiz = {
                questions: selected,
                currentIndex: 0,
                score: 0,
                startTime: new Date()
            };
            
            // Show quiz interface
            document.getElementById('main-interface').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            document.querySelector('.back-btn').style.display = 'block';
            document.getElementById('header-subtitle').textContent = 'Good luck!';
            
            document.getElementById('total-q').textContent = selected.length;
            
            showQuestion();
        }

        // Show current question
        function showQuestion() {
            if (currentQuiz.currentIndex >= currentQuiz.questions.length) {
                endQuiz();
                return;
            }
            
            const question = currentQuiz.questions[currentQuiz.currentIndex];
            
            document.getElementById('current-q').textContent = currentQuiz.currentIndex + 1;
            document.getElementById('quiz-score').textContent = currentQuiz.score;
            document.getElementById('question-text').textContent = question.question;
            
            // Create options
            const options = [question.correct, ...question.wrong].sort(() => Math.random() - 0.5);
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';
            
            options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.style.background = '#f1f3f4';
                btn.style.width = '100%';
                btn.textContent = option;
                btn.onclick = () => checkAnswer(option, question.correct);
                optionsContainer.appendChild(btn);
            });
            
            // Reset feedback
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('next-btn').disabled = true;
        }

        // Check answer
        function checkAnswer(selected, correct) {
            const isCorrect = selected === correct;
            
            if (isCorrect) {
                currentQuiz.score++;
            }
            
            // Visual feedback
            const options = document.getElementById('options').children;
            for (let btn of options) {
                if (btn.textContent === correct) {
                    btn.style.background = '#4CAF50';
                    btn.style.color = 'white';
                } else if (btn.textContent === selected && !isCorrect) {
                    btn.style.background = '#f44336';
                    btn.style.color = 'white';
                }
                btn.onclick = null;
            }
            
            // Show feedback
            const feedback = document.getElementById('feedback');
            feedback.classList.remove('hidden');
            feedback.style.background = isCorrect ? '#d4edda' : '#f8d7da';
            feedback.style.color = isCorrect ? '#155724' : '#721c24';
            feedback.innerHTML = `<strong>${isCorrect ? '‚úì Correct!' : '‚úó Incorrect'}</strong><br>The answer is: ${correct}`;
            
            // Enable next button
            document.getElementById('next-btn').disabled = false;
        }

        // Next question
        function nextQuestion() {
            currentQuiz.currentIndex++;
            showQuestion();
        }

        // End quiz
        function endQuiz() {
            const percentage = Math.round((currentQuiz.score / currentQuiz.questions.length) * 100);
            
            // Update user stats
            const updates = {
                totalScore: firebase.firestore.FieldValue.increment(currentQuiz.score),
                gamesPlayed: firebase.firestore.FieldValue.increment(1),
                lastPlayed: new Date()
            };
            
            db.collection('users').doc(currentUser.username).update(updates).then(() => {
                currentUser.totalScore += currentQuiz.score;
                currentUser.gamesPlayed += 1;
            });
            
            // Show results
            document.getElementById('quiz-container').innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <h2 style="color: #667eea; margin-bottom: 20px;">Quiz Complete! üéâ</h2>
                    <div class="stat-card" style="max-width: 300px; margin: 0 auto 20px;">
                        <div class="stat-value">${currentQuiz.score}/${currentQuiz.questions.length}</div>
                        <div class="stat-label">${percentage}% Accuracy</div>
                    </div>
                    <p style="color: #666; margin-bottom: 20px;">
                        You earned ${currentQuiz.score} points!
                    </p>
                    <button class="btn btn-primary" onclick="goBack()">Back to Menu</button>
                </div>
            `;
        }

        // Add new question
        function addQuestion() {
            const city = document.getElementById('new-city').value;
            const mode = document.getElementById('new-mode').value;
            const question = document.getElementById('new-question').value.trim();
            const correct = document.getElementById('new-correct').value.trim();
            const wrong = document.getElementById('new-wrong').value.trim();
            
            if (!question || !correct || !wrong) {
                alert('Please fill in all fields!');
                return;
            }
            
            const wrongOptions = wrong.split(',').map(opt => opt.trim()).filter(opt => opt);
            if (wrongOptions.length < 3) {
                alert('Please provide at least 3 wrong options!');
                return;
            }
            
            // Add to Firestore
            db.collection('questions').add({
                city: city,
                mode: mode,
                question: question,
                correct: correct,
                wrong: wrongOptions.slice(0, 3),
                addedBy: currentUser.username,
                addedAt: new Date()
            }).then(() => {
                // Update user stats
                db.collection('users').doc(currentUser.username).update({
                    questionsAdded: firebase.firestore.FieldValue.increment(1)
                });
                
                // Show success message
                document.getElementById('add-feedback').innerHTML = `
                    <div class="success-message">
                        ‚úì Question added successfully! Thanks for contributing!
                    </div>
                `;
                
                // Clear form
                document.getElementById('new-question').value = '';
                document.getElementById('new-correct').value = '';
                document.getElementById('new-wrong').value = '';
                
                // Reload questions
                loadQuestions();
                
                // Clear message after 3 seconds
                setTimeout(() => {
                    document.getElementById('add-feedback').innerHTML = '';
                }, 3000);
            }).catch(error => {
                console.error('Error adding question:', error);
                document.getElementById('add-feedback').innerHTML = `
                    <div class="error-message">
                        ‚úó Error adding question. Please try again.
                    </div>
                `;
            });
        }

        // Load leaderboard
        function loadLeaderboard() {
            db.collection('users')
                .orderBy('totalScore', 'desc')
                .limit(10)
                .get()
                .then(snapshot => {
                    let html = '';
                    let rank = 1;
                    
                    snapshot.forEach(doc => {
                        const user = doc.data();
                        html += `
                            <div class="leaderboard-entry">
                                <div>
                                    <span class="leaderboard-rank">#${rank}</span>
                                    ${doc.id}
                                </div>
                                <div>${user.totalScore} pts</div>
                            </div>
                        `;
                        rank++;
                    });
                    
                    if (html === '') {
                        html = '<p style="text-align: center; color: #666;">No scores yet. Be the first!</p>';
                    }
                    
                    document.getElementById('leaderboard-list').innerHTML = html;
                });
        }

        // Update profile
        function updateProfile() {
            document.getElementById('profile-score').textContent = currentUser.totalScore || 0;
            document.getElementById('profile-games').textContent = currentUser.gamesPlayed || 0;
            document.getElementById('profile-questions').textContent = currentUser.questionsAdded || 0;
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            if (tabName === 'leaderboard') {
                loadLeaderboard();
            } else if (tabName === 'profile') {
                updateProfile();
            }
        }

        // Navigation
        function goBack() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('main-interface').classList.remove('hidden');
            document.querySelector('.back-btn').style.display = 'none';
            document.getElementById('header-subtitle').textContent = 'Test your knowledge!';
            
            // Reset quiz container for next time
            document.getElementById('quiz-container').innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <span style="font-size: 1.2em; color: #667eea;">Q<span id="current-q">1</span>/<span id="total-q">10</span></span>
                    <span style="font-size: 1.2em; color: #4CAF50;">Score: <span id="quiz-score">0</span></span>
                </div>

                <div style="background: #f8f9ff; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <h3 id="question-text" style="margin-bottom: 20px;"></h3>
                    <div id="options" style="display: grid; gap: 10px;"></div>
                </div>

                <div id="feedback" class="hidden" style="padding: 15px; border-radius: 10px; margin-bottom: 20px;"></div>

                <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()" disabled>Next Question</button>
            `;
            
            loadQuestions();
        }

        // Logout
        function logout() {
            if (confirm('Are you sure you want to sign out?')) {
                localStorage.removeItem('geoQuizUsername');
                location.reload();
            }
        }

        // Start app when page loads
        window.addEventListener('DOMContentLoaded', () => {
            checkConnection();
        });
    </script>
</body>
</html>
